mutate(transform = ifelse(transform == "level", "RV", "log(RV)"))
# GGMC performs clearly better for log RV
# Performance seems to be almost the same for RV in levels
# GGMC is much more consistent with performance though, shown by narrower boxes
stats %>%
mutate(net = as.character(net)) %>%
select(net, method, starts_with("rmse")) %>%
pivot_longer(starts_with("rmse"),
names_to = c(".value", "transform"),
names_sep = "_") %>%
mutate(transform = ifelse(transform == "level", "RV", "log(RV)")) %>%
left_join(baseline_rmse, by = "transform")
# GGMC performs clearly better for log RV
# Performance seems to be almost the same for RV in levels
# GGMC is much more consistent with performance though, shown by narrower boxes
stats %>%
mutate(net = as.character(net)) %>%
select(net, method, starts_with("rmse")) %>%
pivot_longer(starts_with("rmse"),
names_to = c(".value", "transform"),
names_sep = "_") %>%
mutate(transform = ifelse(transform == "level", "RV", "log(RV)")) %>%
left_join(baseline_rmse, by = "transform") %>%
ggplot(aes(x = net, y = rmse)) +
geom_boxplot() +
geom_hline(aes(yintercept = har_rmse, color = "HAR Benchmark")) +
facet_grid(cols = vars(method), rows = vars(transform), scales = "free") +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Network ID") +
ylab("RMSE") +
theme_bw()
# mixing does not seem to play an important role
ggmc_stats %>%
mutate(net = as.character(net)) %>%
select(net, rhat_sigma, starts_with("rmse")) %>%
pivot_longer(starts_with("rmse"),
names_to = c(".value", "transform"),
names_sep = "_") %>%
mutate(transform = ifelse(transform == "level", "RV", "log(RV)"),
good_mixing = rhat_sigma < 1.01) %>%
left_join(baseline_rmse, by = "transform") %>%
ggplot(aes(x = good_mixing, y = rmse)) +
geom_boxplot() +
geom_hline(aes(yintercept = har_rmse, color = "HAR Benchmark")) +
facet_grid(cols = vars(net), rows = vars(transform), scales = "free") +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Good Mixing") +
ylab("RMSE") +
theme_bw()
# GGMC performs clearly better for log RV
# Performance seems to be almost the same for RV in levels
# GGMC is much more consistent with performance though, shown by narrower boxes
stats %>%
mutate(net = as.character(net)) %>%
select(net, method, starts_with("rmse")) %>%
pivot_longer(starts_with("rmse"),
names_to = c(".value", "transform"),
names_sep = "_") %>%
mutate(transform = ifelse(transform == "level", "RV", "log(RV)")) %>%
left_join(baseline_rmse, by = "transform") %>%
ggplot(aes(x = net, y = rmse)) +
geom_boxplot() +
geom_hline(aes(yintercept = har_rmse, color = "HAR Benchmark")) +
facet_grid(cols = vars(method), rows = vars(transform), scales = "free") +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Network ID") +
ylab("RMSE") +
theme_bw()
# mixing does not seem to play an important role
ggmc_stats %>%
mutate(net = as.character(net)) %>%
select(net, rhat_sigma, starts_with("rmse")) %>%
pivot_longer(starts_with("rmse"),
names_to = c(".value", "transform"),
names_sep = "_") %>%
mutate(transform = ifelse(transform == "level", "RV", "log(RV)"),
good_mixing = rhat_sigma < 1.01) %>%
left_join(baseline_rmse, by = "transform") %>%
ggplot(aes(x = good_mixing, y = rmse)) +
geom_boxplot() +
geom_hline(aes(yintercept = har_rmse, color = "HAR Benchmark")) +
facet_grid(cols = vars(net), rows = vars(transform), scales = "free") +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
guides(color = guide_legend(title = "")) +
xlab("Good Mixing") +
ylab("RMSE") +
theme_bw() +
theme(legend.position = "top")
# GGMC performs clearly better for log RV
# Performance seems to be almost the same for RV in levels
# GGMC is much more consistent with performance though, shown by narrower boxes
stats %>%
mutate(net = as.character(net)) %>%
select(net, method, starts_with("rmse")) %>%
pivot_longer(starts_with("rmse"),
names_to = c(".value", "transform"),
names_sep = "_") %>%
mutate(transform = ifelse(transform == "level", "RV", "log(RV)")) %>%
left_join(baseline_rmse, by = "transform") %>%
ggplot(aes(x = net, y = rmse)) +
geom_boxplot() +
geom_hline(aes(yintercept = har_rmse, color = "HAR Benchmark")) +
facet_grid(cols = vars(method), rows = vars(transform), scales = "free") +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
guides(color = guide_legend(title = "")) +
xlab("Network ID") +
ylab("RMSE") +
theme_bw()
# GGMC performs clearly better for log RV
# Performance seems to be almost the same for RV in levels
# GGMC is much more consistent with performance though, shown by narrower boxes
stats %>%
mutate(net = as.character(net)) %>%
select(net, method, starts_with("rmse")) %>%
pivot_longer(starts_with("rmse"),
names_to = c(".value", "transform"),
names_sep = "_") %>%
mutate(transform = ifelse(transform == "level", "RV", "log(RV)")) %>%
left_join(baseline_rmse, by = "transform") %>%
ggplot(aes(x = net, y = rmse)) +
geom_boxplot() +
geom_hline(aes(yintercept = har_rmse, color = "HAR Benchmark")) +
facet_grid(cols = vars(method), rows = vars(transform), scales = "free") +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
guides(color = guide_legend(title = "")) +
xlab("Network ID") +
ylab("RMSE") +
theme_bw() +
theme(legend.position = "top")
var_translate = c(
"VaR_0_1" = "VaR 0.1%",
"VaR_1_0" = "VaR 1%",
"VaR_5_0" = "VaR 5%",
"VaR_10_0" = "VaR 10%"
)
var_target = c(
"VaR_0_1" = 0.001,
"VaR_1_0" = 0.01,
"VaR_5_0" = 0.05,
"VaR_10_0" = 0.1
)
var_ordering <- c("VaR 0.1%", "VaR 1%", "VaR 5%", "VaR 10%")
# Both not good for VaR
# BBB performance sensitive to network while GGMC performance
# is consistent
stats %>%
mutate(net = as.character(net)) %>%
select(net, method, starts_with("VaR")) %>%
pivot_longer(starts_with("VaR"),
names_to = "measure",
values_to = "values") %>%
mutate(target = var_target[measure],
measure = var_translate[measure],
measure = factor(measure, levels = var_ordering)) %>%
ggplot(aes(x = net, y = values)) +
geom_boxplot() +
geom_hline(aes(yintercept = target, color = "Target"), linetype = "dotted", size = 1) +
facet_grid(cols = vars(method), rows = vars(measure), scales = "free") +
scale_color_manual(values = c("Target" = "black")) +
scale_y_continuous(labels = scales::percent) +
guides(color = guide_legend(title = "")) +
xlab("Network ID") + ylab("% test data falling below VaR") +
theme_bw() +
theme(legend.position = "top")
# Both not good for VaR
# BBB performance sensitive to network while GGMC performance
# is consistent
stats %>%
mutate(net = as.character(net)) %>%
select(net, method, starts_with("VaR")) %>%
pivot_longer(starts_with("VaR"),
names_to = "measure",
values_to = "values") %>%
mutate(target = var_target[measure],
measure = var_translate[measure],
measure = factor(measure, levels = var_ordering))
baseline_stats %>%
select(starts_with("VaR")) %>%
pivot_longer(everything(),
names_to = "measure",
values_to = "har_var")
baseline_var <- baseline_stats %>%
select(starts_with("VaR")) %>%
pivot_longer(everything(),
names_to = "measure",
values_to = "har_var")
# Both not good for VaR
# BBB performance sensitive to network while GGMC performance
# is consistent
stats %>%
mutate(net = as.character(net)) %>%
select(net, method, starts_with("VaR")) %>%
pivot_longer(starts_with("VaR"),
names_to = "measure",
values_to = "values") %>%
left_join(baseline_var, by = "measure")
# Both not good for VaR
# BBB performance sensitive to network while GGMC performance
# is consistent
stats %>%
mutate(net = as.character(net)) %>%
select(net, method, starts_with("VaR")) %>%
pivot_longer(starts_with("VaR"),
names_to = "measure",
values_to = "values") %>%
left_join(baseline_var, by = "measure") %>%
mutate(target = var_target[measure],
measure = var_translate[measure],
measure = factor(measure, levels = var_ordering))
# Both not good for VaR
# BBB performance sensitive to network while GGMC performance
# is consistent
stats %>%
mutate(net = as.character(net)) %>%
select(net, method, starts_with("VaR")) %>%
pivot_longer(starts_with("VaR"),
names_to = "measure",
values_to = "values") %>%
left_join(baseline_var, by = "measure") %>%
mutate(target = var_target[measure],
measure = var_translate[measure],
measure = factor(measure, levels = var_ordering)) %>%
ggplot(aes(x = net, y = values)) +
geom_boxplot() +
geom_hline(aes(yintercept = target, color = "Target"), linetype = "dotted", size = 1) +
geom_hline(aes(yintercept = har_var, color = "HAR Benchmark"), size = 1) +
facet_grid(cols = vars(method), rows = vars(measure), scales = "free") +
scale_color_manual(values = c("Target" = "black", "HAR Benchmark" = "red")) +
scale_y_continuous(labels = scales::percent) +
guides(color = guide_legend(title = "")) +
xlab("Network ID") + ylab("% test data falling below VaR") +
theme_bw() +
theme(legend.position = "top")
library(tidyverse)
library(data.table)
rm(list = ls())
read_data <- function(f){
netid <- str_match(f, "net([0-9]*)")[,2]
rep <- str_match(f, "rep([0-9]*)")[,2]
tmp <- fread(f)
tmp[, netid := netid]
tmp[, rep := rep]
return(tmp)
}
path <- "../"
files <- list.files(path)
files <- files[str_detect(files, "qperformance")]
files_ggmc <- files[!str_detect(files, "bbb")]
files_bbb <- files[str_detect(files, "bbb")]
ggmc_qperformance <- do.call(rbind, lapply(paste0(path, files_ggmc), read_data))
ggmc_qperformance <- as_tibble(ggmc_qperformance) %>% mutate(method = "GGMC")
bbb_qperformance <- do.call(rbind, lapply(paste0(path, files_bbb), read_data))
bbb_qperformance <- as_tibble(bbb_qperformance) %>% mutate(method = "BBB")
files_ggmc
path <- "../"
files <- list.files(path)
files <- files[str_detect(files, "qperformance")]
files_ggmc <- files[!str_detect(files, "bbb|baseline")]
files_bbb <- files[str_detect(files, "bbb")]
files_baseline <- files[str_detect(files, "baseline")]
ggmc_qperformance <- do.call(rbind, lapply(paste0(path, files_ggmc), read_data))
ggmc_qperformance <- as_tibble(ggmc_qperformance) %>% mutate(method = "GGMC")
bbb_qperformance <- do.call(rbind, lapply(paste0(path, files_bbb), read_data))
bbb_qperformance <- as_tibble(bbb_qperformance) %>% mutate(method = "BBB")
baseline_qperformance <- do.call(rbind, lapply(paste0(path, files_baseline), read_data))
baseline_qperformance <- as_tibble(baseline_qperformance) %>% mutate(method = "BBB")
baseline_qperformance
qperformance <- rbind(ggmc_qperformance, bbb_qperformance)
qperformance
baseline_qperformance
baseline_qperformance <- do.call(rbind, lapply(paste0(path, files_baseline), read_data))
baseline_qperformance <- as_tibble(baseline_qperformance) %>% mutate(method = "Baseline")
baseline_qperformance %>%
select(observed, target) %>%
rename(har_qq = observed)
baseline_qperformacne <- baseline_qperformance %>%
select(observed, target) %>%
rename(har_qq = observed)
qperformance <- rbind(ggmc_qperformance, bbb_qperformance)
qperformance %>%
left_join(baseline_qperformacne, by = "target")
qperformance <- qperformance %>%
left_join(baseline_qperformacne, by = "target")
qperformance %>%
ggplot(aes(x = target, y = observed, group = target)) +
geom_boxplot() +
geom_abline(aes(slope = 1, intercept = 0), color = "red") +
facet_grid(rows = vars(netid), cols = vars(method)) +
scale_y_continuous(labels = scales::percent) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target, y = observed, group = target)) +
geom_line(aes(group = rep), alpha = 0.3) +
geom_abline(aes(slope = 1, intercept = 0), color = "red") +
facet_grid(rows = vars(netid), cols = vars(method)) +
scale_y_continuous(labels = scales::percent) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target, y = observed, group = target)) +
geom_line(aes(group = rep), alpha = 0.3) +
geom_abline(aes(slope = 1, intercept = 0), linetype = "dashed", size = 1) +
geom_line(aes(x = target, y = har_qq, color = "HAR Benchmark")) +
facet_grid(rows = vars(netid), cols = vars(method)) +
scale_y_continuous(labels = scales::percent) +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target, y = observed, group = target)) +
geom_line(aes(group = rep), alpha = 0.3) +
geom_abline(aes(slope = 1, intercept = 0), linetype = "dashed", size = 1) +
facet_grid(rows = vars(netid), cols = vars(method)) +
geom_line(aes(x = target, y = har_qq, color = "HAR Benchmark")) +
scale_y_continuous(labels = scales::percent) +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target, y = observed, group = target)) +
geom_line(aes(group = rep), alpha = 0.3) +
geom_abline(aes(slope = 1, intercept = 0), linetype = "dashed", size = 1) +
facet_grid(rows = vars(netid), cols = vars(method)) +
geom_line(aes(x = target, y = har_qq), color = "red") +
scale_y_continuous(labels = scales::percent) +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
qperformance
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target, y = observed, group = target)) +
geom_line(aes(group = rep), alpha = 0.3) +
geom_abline(aes(slope = 1, intercept = 0), linetype = "dashed", size = 1) +
facet_grid(rows = vars(netid), cols = vars(method)) +
geom_line(aes(x = target, y = har_qq, color = "HAR Benchmark"), size = 10) +
scale_y_continuous(labels = scales::percent) +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target, y = observed, group = target)) +
geom_line(aes(group = rep), alpha = 0.3) +
geom_abline(aes(slope = 1, intercept = 0), linetype = "dashed", size = 1) +
facet_grid(rows = vars(netid), cols = vars(method)) +
geom_line(aes(x = target, y = har_qq, color = "HAR Benchmark")) +
scale_y_continuous(labels = scales::percent) +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target, y = observed, group = target)) +
geom_line(aes(group = rep), alpha = 0.3) +
geom_line(aes(x = target, y = har_qq, color = "HAR Benchmark")) +
geom_abline(aes(slope = 1, intercept = 0), linetype = "dashed", size = 1) +
facet_grid(rows = vars(netid), cols = vars(method)) +
scale_y_continuous(labels = scales::percent) +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target)) +
geom_line(aes(y = observed, group = rep), alpha = 0.3) +
geom_line(aes(y = har_qq, color = "HAR Benchmark")) +
geom_abline(aes(slope = 1, intercept = 0), linetype = "dashed", size = 1) +
facet_grid(rows = vars(netid), cols = vars(method)) +
scale_y_continuous(labels = scales::percent) +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target)) +
geom_line(aes(y = observed, group = rep), alpha = 0.3) +
geom_line(aes(y = har_qq, color = "HAR Benchmark")) +
geom_abline(aes(slope = 1, intercept = 0), linetype = "dashed", size = 1) +
facet_grid(rows = vars(netid), cols = vars(method)) +
scale_y_continuous(labels = scales::percent) +
scale_color_manual(values = c("HAR Benchmark" = "red"), linetype = "dotted") +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target)) +
geom_line(aes(y = observed, group = rep), alpha = 0.3) +
geom_line(aes(y = har_qq, color = "HAR Benchmark"), linetype = "dotted") +
geom_abline(aes(slope = 1, intercept = 0), linetype = "dashed", size = 1) +
facet_grid(rows = vars(netid), cols = vars(method)) +
scale_y_continuous(labels = scales::percent) +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target)) +
geom_line(aes(y = observed, group = rep), alpha = 0.3) +
geom_line(aes(y = har_qq, color = "HAR Benchmark"), linetype = "dotted", size = 1) +
geom_abline(aes(slope = 1, intercept = 0), linetype = "dashed", size = 1) +
facet_grid(rows = vars(netid), cols = vars(method)) +
scale_y_continuous(labels = scales::percent) +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
theme_bw() +
theme(legend.position = "top")
# - qqperformance is better for or more consistent for GGMC
# estimated models
# - Both models seem to especially struggle in the 10 to 60% range
qperformance %>%
ggplot(aes(x = target)) +
geom_line(aes(y = observed, group = rep), alpha = 0.3) +
geom_line(aes(y = har_qq, color = "HAR Benchmark"), linetype = "dotted", size = 1) +
geom_abline(aes(slope = 1, intercept = 0), linetype = "dashed", size = 1) +
facet_grid(rows = vars(netid), cols = vars(method)) +
scale_y_continuous(labels = scales::percent) +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
xlab("Target Quantile") +
ylab("% test data falling below quantile") +
guides(color = guide_legend(title = "")) +
theme_bw() +
theme(legend.position = "top")
#  - Netowrk does not make a difference for GGMC but for BBB
# - For some reasons larger RNN network consistently bad results using BBB
# but not using GGMC
qperformance %>%
group_by(netid, rep, method) %>%
summarise(qqdiff = sum(abs(target - observed)),
.groups = "drop") %>%
ggplot(aes(x = netid, y = qqdiff)) +
geom_boxplot() +
facet_grid(cols = vars(method)) +
ylab("Quantile-Quantile Difference") +
xlab("Network ID") +
theme_bw()
#  - Netowrk does not make a difference for GGMC but for BBB
# - For some reasons larger RNN network consistently bad results using BBB
# but not using GGMC
qperformance %>%
group_by(netid, rep, method) %>%
summarise(qqdiff = sum(abs(target - observed)),
har_qqdiff = sum(abs(target - har_qq)),
.groups = "drop")
#  - Netowrk does not make a difference for GGMC but for BBB
# - For some reasons larger RNN network consistently bad results using BBB
# but not using GGMC
qperformance %>%
group_by(netid, rep, method) %>%
summarise(qqdiff = sum(abs(target - observed)),
har_qqdiff = sum(abs(target - har_qq)),
.groups = "drop") %>%
ggplot(aes(x = netid, y = qqdiff)) +
geom_boxplot() +
geom_hline(aes(yintercept = har_qqdiff, color = "HAR Benchmark")) +
facet_grid(cols = vars(method)) +
scale_color_manual(values = c("HAR Benchmark" = "red")) +
guides(color = guide_legend(title = "")) +
ylab("Quantile-Quantile Difference") +
xlab("Network ID") +
theme_bw() +
theme(legend.position = "top")
